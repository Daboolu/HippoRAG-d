from igraph import Graph
import pickle

# ============================================================
# 1) 创建图（无向图）
# ============================================================
g = Graph()
g.add_vertices(5)         # 节点 ID: 0,1,2,3,4
g.add_edges([(0,1), (1,2), (2,3)])
g.add_edge(3, 4)

print("初始图：")
print(g)

# ============================================================
# 2) 增 (Create)
# ============================================================

# 新增一个节点
g.add_vertex(name="new_node")
# 新增一条边
g.add_edge(4, "new_node")

print("\n增加节点和边：")
print(g)

# ============================================================
# 3) 查 (Read)
# ============================================================

print("\n所有节点：", g.vs.indices)
print("所有边：", g.es.indices)

# 给节点/边添加属性
g.vs["label"] = [f"node_{i}" for i in range(len(g.vs))]
g.es["weight"] = [1.0] * len(g.es)

print("节点属性 label：", g.vs["label"])
print("边属性 weight：", g.es["weight"])

# 查找某个节点的邻居
neighbors = g.neighbors(1)
print("节点 1 的邻居：", neighbors)

# ============================================================
# 4) 改 (Update)
# ============================================================

# 修改节点属性
g.vs[1]["label"] = "updated_node"
# 修改边属性
g.es[0]["weight"] = 3.14

print("\n更新后的节点 label：", g.vs["label"])
print("更新后的边 weight：", g.es["weight"])

# ============================================================
# 5) 删 (Delete)
# ============================================================

# 删除一条边（例如第 0 条）
g.delete_edges([0])
# 删除一个节点（例如节点 4）
g.delete_vertices([4])

print("\n删除节点/边后的图：")
print(g)

# ============================================================
# 6) 保存为 pickle
# ============================================================

pickle_path = "my_graph.pkl"
with open(pickle_path, "wb") as f:
    pickle.dump(g, f)

print(f"\n图已保存为：{pickle_path}")

# ============================================================
# 7) 从 pickle 读取
# ============================================================

with open(pickle_path, "rb") as f:
    g_loaded = pickle.load(f)

print("\n从 pickle 加载后的图：")
print(g_loaded)
